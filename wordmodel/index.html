<!DOCTYPE html>
<html lang="zh-cn">


<!-- Mirrored from www.lixin.me/wordmodel/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Apr 2019 02:51:49 GMT -->
<head>
    <title>在线hzk16点阵字模生成，取字模，oled取模</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="styleSheet" href="css/bootstrap.min.css">
    <link rel="styleSheet" href="css/flat-ui.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/flat-ui.min.js"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "../../hm.baidu.com/hm4e6b.js?3266e9d3684e7a1307dc7c4b4a64b0ae";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>

<body>
    <div class="navbar-wrapper" style="background-color:#5a5a5a;padding-top:20px;">
        <div class="container">
            <nav class="navbar navbar-inverse  navbar-embossed" role="navigation">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
                        <a class="navbar-brand" href="http://www.lixin.me/">李鑫的小站</a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <!--<li class="active"><a href="http://www.lixin.me/wechat-article/index.html">微信文章分享</a></li>-->

                        </ul>
                    </div>
                    <!-- /.navbar-collapse -->
                </div>
                <!-- /.container-fluid -->
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="text-center">
            <h4>在线16*16点阵汉字取模</h4>
            <p>在oled、led显示屏中显示汉字需要取字模，很多字模软件都是windows下的exe，本页面提供在线js版本，更方便。建议使用流行的新版本浏览器，如谷歌浏览器、火狐浏览器等。本功能基本原理为获取汉字的unicode，通过查表法得到对应的GB2312码，然后使用HZK16字库在canvas画布上绘制出16*16的点阵汉字。</p>
            <hr/>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" id="word" name="word" value="鑫" placeholder="请输入一个汉字" maxlength="1" class="form-control" style="width:auto;margin-right:8px;">
                    <button class="btn btn-inverse" type="button" onclick="myDoIt()">显示</button>
                </div>
                <div class="well" style="margin-top:10px;">

                    <button type="button" class="btn btn-info" onclick="generateHexArry()">生成16进制数组</button>
                    <button type="button" class="btn btn-info" onclick="generateBitArry()">生成256个1010</button>
                </div>
                <div>
                    <p>*对该功能有什么建议请告诉我！</p>
                </div>
            </div>
            <div class="col-md-6">
                <canvas id="myCanvas" height="320" width="320"></canvas>
            </div>
        </div>
        <div class="row" id="codePanel">
            <textarea id="codeArea" rows="3" class="form-control"></textarea>
        </div>
    </div>
<div class="container">
    <hr>
    
</div>


    <script>
        var g = {
            map: {},
            hzk16: null,
            wordData: null
        }

        function generateBitArry() {
            if (g.wordData == null) {
                myDoIt();
            }
            var codeArea = document.getElementById("codeArea");
            codeArea.value = '';
            var tmp = [];
            for (var i = 0; i < g.wordData.length; i++) {
                tmp.push(g.wordData[i].toString(2));
            }
            codeArea.value = tmp.join("");
        }

        function generateHexArry() {
            if (g.wordData == null) {
                myDoIt();
            }
            var codeArea = document.getElementById("codeArea");
            codeArea.value = '';
            var tmp = [];
            for (var i = 0; i < g.wordData.length; i++) {
                tmp.push("0x" + g.wordData[i].toString(16));
            }
            codeArea.value = "{" + tmp.join(" ,") + "}";
        }

        function myDoIt() {
            var word = document.getElementById("word");
            if (word.value.length == 0) {
                alert("请先输入一个汉字");
                return;
            }
            var unicodeVal = word.value.charCodeAt(0).toString(16).toUpperCase();
            console.info("'%s'该字的unicode码为：%s", word.value, unicodeVal);
            var gb2312Val = '';
            if (!g.map.hasOwnProperty(unicodeVal)) {
                alert("找不到该字");
                return;
            }
            gb2312Val = g.map[unicodeVal];
            console.info("对应的gb2312为:%s", gb2312Val);
            var byte1 = parseInt(gb2312Val.substring(0, 2), 16);
            var byte2 = parseInt(gb2312Val.substring(2, 4), 16);
            console.info('byte1:%s,byte2:%s', byte1, byte2);
            var hzk_offset = (94 * (byte1 - 160 - 1) + (byte2 - 160 - 1)) * 32;
            console.info("在hzk16中的偏移为：%d", hzk_offset);
            g.wordData = g.hzk16.slice(hzk_offset, hzk_offset + 32);
            var wordData = g.hzk16.slice(hzk_offset, hzk_offset + 32);
            var index = 0;
            clearCanvas();
            for (var i = 0; i < 32; i++) {

                for (var j = 0; j < 8; j++) {
                    if (wordData[i] & 0x80) {
                        var row = parseInt(index / 16);
                        var col = index % 16;
                        fillCell(col, row);
                    }
                    wordData[i] = wordData[i] << 1;
                    index++;
                }

            }
            initCanvas();
        }

        function clearCanvas() {
            var myCanvas = document.getElementById("myCanvas");
            var cvas_width = myCanvas.clientWidth;
            var ctx = myCanvas.getContext('2d');
            ctx.fillStyle = "#fff";
            ctx.clearRect(0, 0, cvas_width, cvas_width);
        }

        function myInit() {
            $.get('unicode-gb2312.txt').done(function (data) {
                items = data.split("\n");
                for (var i = 1; i < items.length; i++) {
                    kv = items[i].split(' ');
                    g.map[kv[0]] = kv[1];
                }
                console.info("加载对照表成功");
            });
            getHZK16Bin();
            initCanvas();

        }

        function getHZK16Bin() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', './HZK16.dat', true);
            xhr.responseType = 'arraybuffer';
            xhr.onload = function (e) {
                g.hzk16 = new Uint8Array(this.response);
                console.info('response类型为:%s', typeof g.hzk16)
            };
            xhr.send();
        }

        function fillCell(col, row, color) {
            color = color || "#40a23c";
            var myCanvas = document.getElementById("myCanvas");
            var cvas_width = myCanvas.clientWidth;
            var cell_width = cvas_width / 16;
            var ctx = myCanvas.getContext('2d');
            ctx.fillStyle = color;
            var point_x = col * cell_width;
            var point_y = row * cell_width;
            ctx.fillRect(point_x, point_y, cell_width, cell_width);

        }

        function initCanvas() {
            var myCanvas = document.getElementById("myCanvas");
            var ctx = myCanvas.getContext('2d');
            var cvas_width = myCanvas.clientWidth;
            var cell_width = cvas_width / 16;
            ctx.fillStyle = "#000";
            for (var row = 0; row <= 16; row++) {
                ctx.beginPath();
                ctx.moveTo(0, row * cell_width);
                ctx.lineTo(cvas_width, row * cell_width);
                ctx.stroke();
                ctx.closePath();

            }
            for (var col = 0; col <= 16; col++) {
                ctx.beginPath();
                ctx.moveTo(col * cell_width, 0);
                ctx.lineTo(col * cell_width, cvas_width);
                ctx.stroke();
                ctx.closePath();
            }
        }
        $(function () {
            myInit();
        })
    </script>
</body>


<!-- Mirrored from www.lixin.me/wordmodel/ by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 28 Apr 2019 02:51:57 GMT -->
</html>